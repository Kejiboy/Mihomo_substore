# Mihomo Substore

完美实现了阻止 DNS 泄漏和链式代理的 Mihomo 代理配置方案。

## 功能特性

- ✅ DNS 泄漏防护
- ✅ 链式代理支持
- ✅ 自定义规则管理
- ✅ 灵活的代理分组

## 文件说明

| 文件                         | 说明                           |
|----------------------------|------------------------------|
| `grok.yaml`                | Mihomo 主配置文件，包含 DNS、规则、代理组设置 |
| `mihomo配置.json`            | Sub-Store 配置模板，用于订阅管理        |
| `sub-store组合订阅模板.json`     | Sub-Store 组合订阅模板             |
| `custom-proxy.yaml`        | 自定义代理规则                      |
| `custom-direct.yaml`       | 自定义直连规则                      |
| `chainProxy.js`            | 链式代理脚本                       |

## 使用方法

### 1. 添加订阅

自行添加单条订阅，可通过脚本为节点增加前缀：

```javascript
$server.name = '落地-' + $server.name
```

### 2. 导入 Sub-Store 模板

在 Sub-Store 订阅管理页面导入 `sub-store组合订阅模板.json`

### 3. 导入 Mihomo 配置

在文件管理页面导入 `mihomo配置.json`

### 4. 自定义规则

- `custom-proxy.yaml` - 自定义代理规则（走代理）
- `custom-direct.yaml` - 自定义直连规则（直连）

根据需要编辑这两个文件。

### 5. DNS 配置

配置包含多个国内外 DNS 服务器，支持 DoH 加密查询，防止 DNS 泄漏。默认 DNS 包括：
- 阿里 DNS (223.5.5.5)
- 腾讯 DNS (1.2.4.8)
- 360 DNS (119.29.29.29)
- 百度 DNS (180.76.76.76)

### 6. 自定义 Gist 规则

在 `grok.yaml` 的 `rule-providers` 部分配置自定义 Gist 规则：

```yaml
MyCustomRules:
  type: http
  format: yaml
  behavior: classical
  url: https://gist.githubusercontent.com/your-username/your-gist-id/raw/your-rules.yaml
  path: ./rule-providers/my-custom-rules.yaml
  interval: 86400
```

然后在 `rules` 部分添加规则应用：

```yaml
- "RULE-SET,MyCustomRules,🔗 全局直连"
```

**注意**：Gist 规则格式应为 `DOMAIN-SUFFIX,example.com`，不需要添加代理组后缀。

## 代理组说明

### 基础代理组

| 代理组         | 说明              |
|-------------|-----------------|
| 🔰 模式选择     | 主选择器，用于快速切换代理模式    |
| ⚙️ 节点选择     | 普通节点选择（排除落地/家宽节点）  |
| 🕊️ 落地节点    | 落地/家宽节点（支持链式代理） |

### 策略代理组

| 代理组         | 说明              |
|-------------|-----------------|
| ♻️ 延迟选优     | 自动选择延迟最低的节点     |
| 🚑 故障转移     | 节点故障时自动切换       |
| ⚖️ 负载均衡(散列) | 一致性哈希负载均衡       |
| ☁️ 负载均衡(轮询) | 轮询负载均衡          |

### 国家级代理组

| 代理组         | 说明              |
|-------------|-----------------|
| 🇺🇸 美国节点    | 自动筛选美国节点        |
| 🇯🇵 日本节点    | 自动筛选日本节点        |
| 🇸🇬 新加坡节点   | 自动筛选新加坡节点       |
| 🇭🇰 香港节点    | 自动筛选香港节点        |

### 功能代理组

| 代理组         | 说明              |
|-------------|-----------------|
| 🔗 全局直连     | 直连模式            |
| 🐬 自定义直连    | 自定义直连规则         |
| 🐳 自定义代理    | 自定义代理规则         |
| 🌍 国外媒体    | 国外媒体流量代理       |
| 🌏 国内媒体    | 国内媒体流量直连       |
| 💸 ChatGPT-Gemini-XAI-Perplexity | AI 服务代理 |
| 💵 Claude | Claude 服务代理 |
| 🪙 Bybit | 加密货币交易所代理 |
| 🅿️ PikPak | PikPak 下载代理 |
| 📲 电报消息 | Telegram 代理 |
| 📢 谷歌服务 | Google 服务代理 |
| 🍎 苹果服务 | Apple 服务代理 |
| Ⓜ️ 微软服务 | Microsoft 服务代理 |
| 🥰 广告过滤 | 广告拦截 |
| ❌ 全局拦截 | 全局拦截 |
| 🐟 漏网之鱼 | 默认代理组 |

## 链式代理

落地节点（名称包含"落地"或"家宽"）会自动通过普通节点进行链式代理，实现更稳定的连接。

## 使用指南

### 节点命名规范

为了让代理组能正确识别和分类节点，建议按以下规范命名：

**国家标识**：
- 美国：`US`、`USA`、`United States`、`美国`
- 日本：`JP`、`Japan`、`日本`
- 新加坡：`SG`、`Singapore`、`新加坡`
- 香港：`HK`、`HongKong`、`Hong Kong`、`香港`

**落地节点标识**：
- 在节点名称中包含 `落地` 或 `家宽`

**示例**：
- `US-01` → 自动分配到 🇺🇸 美国节点
- `JP-落地-01` → 自动分配到 🇯🇵 日本节点 和 🕊️ 落地节点
- `SG-家宽-01` → 自动分配到 🇸🇬 新加坡节点 和 🕊️ 落地节点

### 代理方案选择

#### 方案 1：直接通过节点代理（推荐用于普通节点）

1. 在客户端选择 **🔰 模式选择**
2. 选择 **⚙️ 节点选择** 或具体国家组（如 🇺🇸 美国节点）
3. 流量直接通过选中的节点代理

**适用场景**：
- 普通代理节点
- 需要特定国家 IP 的场景
- 单层代理足够的情况

#### 方案 2：链式代理（推荐用于落地/家宽节点）

1. 在客户端选择 **🔰 模式选择**
2. 选择 **🕊️ 落地节点**
3. 系统自动通过 **⚙️ 节点选择** 中的普通节点进行链式代理

**工作流程**：
```
用户流量 → 普通节点(⚙️ 节点选择) → 落地节点(🕊️ 落地节点) → 目标服务器
```

**适用场景**：
- 落地/家宽节点
- 需要更稳定连接的场景
- 需要隐藏真实 IP 的场景

#### 方案 3：策略选择（自动故障转移）

1. 在客户端选择 **🔰 模式选择**
2. 选择 **♻️ 延迟选优**、**🚑 故障转移** 或 **⚖️ 负载均衡**
3. 系统自动选择最优节点或在故障时切换

**各策略说明**：
- **♻️ 延迟选优**：自动选择延迟最低的节点
- **🚑 故障转移**：主节点故障时自动切换到备用节点
- **⚖️ 负载均衡(散列)**：根据连接哈希分配到不同节点
- **☁️ 负载均衡(轮询)**：轮流分配到不同节点

**适用场景**：
- 多节点负载均衡
- 需要自动故障转移
- 追求最优性能

#### 方案 4：直连模式

1. 在客户端选择 **🔰 模式选择**
2. 选择 **🔗 全局直连**
3. 所有流量直连，不经过代理

**适用场景**：
- 国内网站访问
- 需要真实 IP 的场景
- 测试本地连接

### 特定服务代理

对于特定服务（如 ChatGPT、Claude、Telegram 等），系统会自动根据规则分配到对应代理组，无需手动选择。

### 配置更新

所有规则和配置文件都支持自动更新，更新间隔为 86400 秒（24 小时）。
